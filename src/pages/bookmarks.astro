---
import Layout from "@/components/astro/layout/Layout.astro";
import bookmarksData from "@/data/bookmarks.json";

const title = "Bookmarks â€” Waleed";
const description = "A collection of useful links and resources";

// Process categories - split comma-separated categories and extract unique values
const allCategories = new Set();
bookmarksData.bookmarks.forEach(bookmark => {
  if (bookmark.category) {
    const categories = bookmark.category.split(',').map(cat => cat.trim());
    categories.forEach(cat => allCategories.add(cat));
  }
});
const uniqueCategories = Array.from(allCategories).sort();
---

<Layout title={title} description={description}>
  <section class=":uno: space-y-6">
    <div class=":uno: space-y-3">
      <h1 class=":uno: font-semibold text-2xl tracking-tight text-heading">Bookmarks</h1>
      <p class=":uno: text-base leading-[1.75]">{description}</p>
    </div>

    <div class=":uno: flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between">
      <!-- Search input -->
      <div class=":uno: relative w-full sm:w-64">
        <input 
          type="text" 
          id="search-input" 
          placeholder="Search bookmarks..." 
          class=":uno: w-full px-3 py-1.5 text-sm border rounded-md bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
        <svg xmlns="http://www.w3.org/2000/svg" class=":uno: absolute right-2 top-2 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>

      <!-- Stats counter -->
      <p id="results-count" class=":uno: text-xs text-gray-500 dark:text-gray-400 mt-2 sm:mt-0">
        Showing {bookmarksData.bookmarks.length} bookmarks
      </p>
    </div>

    <!-- Category filter chips with muted colors and microinteractions -->
    <div class=":uno: flex flex-wrap gap-2 mb-2">
      <button 
        class=":uno: category-chip text-xs px-3 py-1.5 rounded-full bg-blue-50/80 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-transparent hover:border-blue-200 dark:hover:border-blue-800/50 transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-sm" 
        data-category="all"
      >
        All
      </button>
      {uniqueCategories.map(category => (
        <button 
          class=":uno: category-chip text-xs px-3 py-1.5 rounded-full bg-gray-50/80 dark:bg-gray-800/50 text-gray-700 dark:text-gray-300 border border-transparent hover:border-gray-200 dark:hover:border-gray-700/70 transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-sm" 
          data-category={category}
        >
          {category}
        </button>
      ))}
    </div>

    <!-- Compact bookmark grid -->
    <div id="bookmarks-container" class=":uno: grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
      {bookmarksData.bookmarks.map((bookmark) => {
        // Process categories into an array
        const categories = bookmark.category ? bookmark.category.split(',').map(cat => cat.trim()) : [];
        
        return (
          <div 
            data-categories={categories.join(' ')}
            class=":uno: bookmark-card p-3 border border-gray-200 dark:border-gray-800 rounded-md transition-all duration-200 hover:shadow-sm hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-gray-900"
          >
            <div class=":uno: mb-2">
              <h3 class=":uno: font-medium text-sm text-gray-900 dark:text-gray-100">
                <a
                  href={bookmark.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class=":uno: hover:text-blue-600 dark:hover:text-blue-400 flex items-start"
                  title={bookmark.url}
                >
                  {bookmark.name}
                  <svg xmlns="http://www.w3.org/2000/svg" class=":uno: h-3 w-3 ml-1 mt-0.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </h3>
            </div>
            
            <p class=":uno: text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2 h-8">
              {bookmark.description || "No description available"}
            </p>
            
            <div class=":uno: flex flex-wrap gap-1 mt-1">
              {categories.map(category => (
                <span class=":uno: text-[10px] px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded-full text-gray-600 dark:text-gray-400">
                  {category}
                </span>
              ))}
            </div>
          </div>
        );
      })}
    </div>

    <!-- No results message -->
    <div id="no-results" class=":uno: hidden text-center py-6 text-gray-500 dark:text-gray-400 text-sm">
      No bookmarks found matching your search
    </div>
  </section>

  <script>
    // Search and filter functionality
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('search-input');
      const categoryChips = document.querySelectorAll('.category-chip');
      const bookmarkCards = document.querySelectorAll('.bookmark-card');
      const resultsCount = document.getElementById('results-count');
      const noResults = document.getElementById('no-results');
      const bookmarksContainer = document.getElementById('bookmarks-container');

      // Track the current selected category
      let currentCategory = 'all';

      function filterBookmarks() {
        const searchTerm = searchInput.value.toLowerCase();
        
        let visibleCount = 0;

        bookmarkCards.forEach(card => {
          const title = card.querySelector('h3').textContent.toLowerCase();
          const categoriesString = card.dataset.categories;
          const description = card.querySelector('p').textContent.toLowerCase();
          
          const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
          const matchesCategory = currentCategory === 'all' || 
                                 (categoriesString && categoriesString.split(' ').includes(currentCategory));
          
          if (matchesSearch && matchesCategory) {
            card.classList.remove('hidden');
            visibleCount++;
          } else {
            card.classList.add('hidden');
          }
        });

        resultsCount.textContent = `Showing ${visibleCount} bookmarks`;
        
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
          bookmarksContainer.classList.add('hidden');
        } else {
          noResults.classList.add('hidden');
          bookmarksContainer.classList.remove('hidden');
        }

        // Enhanced category chip active state with microinteractions
        categoryChips.forEach(chip => {
          if (chip.dataset.category === currentCategory) {
            chip.classList.add('bg-blue-100', 'dark:bg-blue-800/40', 'text-blue-800', 'dark:text-blue-200', 
                              'border-blue-200', 'dark:border-blue-700', 'shadow-sm', 'scale-105');
            chip.classList.remove('bg-gray-50/80', 'dark:bg-gray-800/50', 'text-gray-700', 'dark:text-gray-300', 
                                'border-transparent');
            
            // Add pulse animation to the active chip
            chip.style.animation = 'pulse 2s infinite';
          } else {
            chip.classList.remove('bg-blue-100', 'dark:bg-blue-800/40', 'text-blue-800', 'dark:text-blue-200', 
                                 'border-blue-200', 'dark:border-blue-700', 'shadow-sm', 'scale-105');
            chip.classList.add('bg-gray-50/80', 'dark:bg-gray-800/50', 'text-gray-700', 'dark:text-gray-300', 
                              'border-transparent');
            
            // Remove animation from inactive chips
            chip.style.animation = '';
          }
        });
      }

      searchInput.addEventListener('input', filterBookmarks);
      
      // Handle category chip clicks
      categoryChips.forEach(chip => {
        chip.addEventListener('click', () => {
          currentCategory = chip.dataset.category;
          filterBookmarks();
        });
      });

      // Initial filter
      filterBookmarks();
    });
  </script>

  <style>
    /* Subtle pulse animation for active filter chip */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.2);
      }
      70% {
        box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }

    /* More subtle dark mode animation */
    @media (prefers-color-scheme: dark) {
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.3);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(96, 165, 250, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(96, 165, 250, 0);
        }
      }
    }

    /* Enhanced focus styles for accessibility */
    .category-chip:focus {
      outline: 2px solid rgba(59, 130, 246, 0.5);
      outline-offset: 2px;
    }

    /* Ensure we don't show outline when using mouse, only for keyboard navigation */
    .category-chip:focus:not(:focus-visible) {
      outline: none;
    }
  </style>
</Layout>

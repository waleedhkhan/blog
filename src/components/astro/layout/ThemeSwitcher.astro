---
import { Icon } from "astro-icon/components";
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Toggle dark mode"
  class="theme-toggle-button"
>
  <Icon name="lucide:sun" class="w-5 h-5 sun-icon" />
  <Icon name="lucide:moon" class="w-5 h-5 moon-icon" />
</button>

<script is:inline>
  function setupThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');

    if (themeToggle) {
      // Remove existing listener to prevent duplicates
      themeToggle.replaceWith(themeToggle.cloneNode(true));
      const newToggle = document.getElementById('theme-toggle');

      newToggle.addEventListener('click', () => {
        const isDarkMode = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
      });
    }
  }

  // Setup on initial load
  setupThemeToggle();

  // Re-setup after view transitions
  document.addEventListener('astro:after-swap', setupThemeToggle);
</script>

<style>
  .theme-toggle-button {
    position: relative;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    margin: 0 4px;
    transition: background-color 0.2s ease;
  }

  @media (max-width: 640px) {
    .theme-toggle-button {
      width: 46px;
      height: 46px;
    }
  }
  
  /* Light mode styling */
  .theme-toggle-button {
    color: #555555;
  }
  
  .theme-toggle-button:hover {
    background-color: #f5f5f5;
  }
  
  /* Dark mode styling */
  :global(.dark) .theme-toggle-button {
    color: #cccccc;
  }
  
  :global(.dark) .theme-toggle-button:hover {
    background-color: #2a2a2a;
  }
  
  .sun-icon, .moon-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: opacity 0.3s, transform 0.5s;
  }
  
  .sun-icon {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(90deg);
  }
  
  .moon-icon {
    opacity: 1;
  }
  
  :global(.dark) .sun-icon {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(0);
  }
  
  :global(.dark) .moon-icon {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(90deg);
  }
</style>

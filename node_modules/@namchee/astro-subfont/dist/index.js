import{defineIntegration as p}from"astro-integration-kit";import{z as n}from"astro/zod";import{execSync as d}from"child_process";import{resolve as f}from"path";import e from"kleur";function c(t){let i=t.match(/Total savings: (-?[\d\.]+ .+[b|B])/);return i?.[1]?i[1]:""}function s(){let t=new Date;return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}var v=p({name:"subset",optionsSchema:n.object({whitelist:n.string().optional().default(""),optimizeVariableFonts:n.boolean().optional().default(!0),inline:n.boolean().optional().default(!1),dynamic:n.boolean().optional().default(!1),debug:n.boolean().optional().default(!1)}).optional().default({}),setup:({options:t})=>({hooks:{"astro:build:done":({dir:i,pages:u})=>{let a=["--in-place","--no-fallbacks"];t?.whitelist&&a.push(`--text=${t.whitelist}`),t?.optimizeVariableFonts&&a.push("--instance"),t?.inline&&a.push("--inline-css"),t?.dynamic&&a.push("--dynamic");let l=u.map(({pathname:o})=>{let r=[i.pathname,o];return o.startsWith("404")?r[1]=`${o.slice(0,-1)}.html`:r.push("index.html"),f(...r)});console.log(e.bgGreen().black(" [astro-subfont] generating optimized fonts "));let g=`subfont ${l.join(" ")} ${a.join(" ")}`;if(t?.debug){console.log(e.dim(s()),e.green("Detected pages:"));for(let o of l)console.log(e.dim(s()),e.green("\u25B6"),o.replace(i.pathname,"")),console.log(e.dim(s()),e.green("  \u2514\u2500"),e.dim(o))}try{let o=d(g,{stdio:"pipe"}),r=c(o.toString());console.log(e.dim(s()),e.green(`\u2713 Successfully reduced font payload by ${r}`),`
`)}catch(o){console.error(e.bgRed(`Failed to optimize fonts due to ${o}`))}}}})});export{v as subset};
//# sourceMappingURL=index.js.map